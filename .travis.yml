dist: xenial
sudo: true
language: python
cache: pip

addons:
  apt:
    packages: rabbitmq-server 
    
services: rabbitmq
python: "3.6.5"

# command to install dependencies
install: pip install -r requirements.txt

# Create a virtual host in RabbitMQ server
before_script:
  - sudo rabbitmq-plugins enable rabbitmq_management
  - sudo rabbitmqctl add_vhost $VHOST
  - sudo rabbitmqctl set_permissions -p $VHOST $USERNAME ".*" ".*" ".*"

# command to run tests
script:
  - pytest tests -x --cov=broker_rabbit --cov-fail-under=76
